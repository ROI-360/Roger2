<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposta Estrat√©gica Interativa | Serramar Trekking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    
    <!-- Scripts for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(180deg, #1A202C 0%, #2D3748 100%);
        }
        .section-gradient-box {
            background: linear-gradient(135deg, #2D3748 0%, #1A202C 100%);
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
        }
        .strong-shadow-box {
            box-shadow: 0px 10px 40px rgba(0, 0, 0, 1), 0px 20px 60px rgba(0, 0, 0, 0.8);
            background-color: #2D3748;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .strong-shadow-box .card-content {
            flex-grow: 1;
        }
        .icon-highlight {
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 0.75rem;
            text-shadow: 0px 0px 20px rgba(0, 0, 0, 1), 0px 0px 30px rgba(0, 0, 0, 0.8);
        }
        .title-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        .plan-button {
            background: #4CAF50;
            color: #fff;
            padding: 0.75rem 2rem;
            border-radius: 999px;
            font-weight: 700;
            text-decoration: none;
            font-size: 1.1rem;
            transition: background 0.3s, opacity 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-top: auto;
        }
        .plan-button:hover:not(:disabled) {
            background: #388e3c;
        }
        .plan-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .timeline {
            position: relative;
            padding: 2rem 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 1.5rem;
            height: 100%;
            width: 4px;
            background: #4CAF50;
            border-radius: 2px;
        }
        .timeline-item {
            position: relative;
            padding-left: 4rem;
            margin-bottom: 2rem;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-icon {
            position: absolute;
            left: 0;
            top: 0;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: #2D3748;
            border: 4px solid #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #4CAF50;
        }
        /* Contract Styles */
        .tab-button.active {
            border-color: #4CAF50;
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .signature-canvas {
            border: 1px solid #4a5568;
            background-color: #f7fafc;
            cursor: crosshair;
            touch-action: none;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #cbd5e1;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #4a5568;
            border-radius: 0.375rem;
            font-size: 1rem;
            color: #e2e8f0;
            background-color: #2d3748;
        }
        .tab-content.hidden, .form-section.hidden { display: none; }
        #notification-toast {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px; border-radius: 8px;
            color: white; font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            z-index: 1000;
        }
        #notification-toast.show {
            opacity: 1; visibility: visible;
            transform: translate(-50%, -10px);
        }
        #notification-toast.success { background-color: #10b981; }
        #notification-toast.error { background-color: #ef4444; }
        #notification-toast.info { background-color: #3b82f6; }
        .spinner {
            animation: spin 1s linear infinite;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#1A202C] text-gray-200">
    <div id="notification-toast"></div>

    <!-- PROPOSAL SECTION -->
    <main id="proposal-section" class="container mx-auto p-2 sm:p-4 md:p-8">
        <header class="text-center py-6 md:py-8">
            <div class="section-gradient-box p-4 sm:p-8 max-w-5xl">
                <div class="icon-highlight" style="font-size: 5rem; margin-bottom: 1.5rem;">üó∫Ô∏è</div>
                <h1 class="text-3xl sm:text-5xl md:text-6xl font-bold text-[#4CAF50] leading-tight mb-4 title-shadow">Serramar Trekking</h1>
                <h2 class="text-2xl sm:text-4xl md:text-5xl font-bold text-[#4CAF50] mb-4 title-shadow">Construindo um Neg√≥cio de Aventura S√≥lido</h2>
                <p class="text-base sm:text-lg md:text-xl text-white max-w-3xl mx-auto mb-4 title-shadow">
                    Vamos sair da depend√™ncia de indica√ß√µes e criar um sistema de aquisi√ß√£o de clientes que trabalha para voc√™.
                </p>
            </div>
        </header>

        <section class="py-6 sm:py-8">
            <div class="section-gradient-box p-4 sm:p-8 max-w-5xl">
                <h2 class="text-2xl sm:text-4xl font-bold text-[#4CAF50] mb-8 text-center title-shadow">Plano de A√ß√£o: A Trilha para o Sucesso</h2>
                <p class="text-white mt-2 max-w-3xl mx-auto mb-12 text-center title-shadow">Nossa parceria ser√° dividida em fases claras, cada uma com objetivos e entreg√°veis definidos para garantir um crescimento sustent√°vel e mensur√°vel.</p>
                
                <div class="timeline max-w-3xl mx-auto">
                    <div class="timeline-item">
                        <div class="timeline-icon">1</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 title-shadow">Fase 1: Funda√ß√£o Estrat√©gica (M√™s 1)</h3>
                        <p class="text-gray-300">O alicerce de todo o projeto. Aqui, garantimos que cada real investido seja direcionado com m√°xima intelig√™ncia.</p>
                        <ul class="list-disc list-inside text-gray-400 mt-4 space-y-1">
                            <li><strong>Diagn√≥stico 360¬∞:</strong> An√°lise de mercado, concorr√™ncia e diferenciais da Serramar.</li>
                            <li><strong>Defini√ß√£o de Avatar:</strong> Mapeamento profundo do cliente ideal (dores, desejos, obje√ß√µes).</li>
                            <li><strong>Estrutura√ß√£o de Contas:</strong> Configura√ß√£o profissional do Gerenciador de An√∫ncios e Pixel.</li>
                            <li><strong>Planejamento de Campanhas:</strong> Defini√ß√£o dos primeiros roteiros a serem impulsionados.</li>
                        </ul>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-icon">2</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 title-shadow">Fase 2: Ativa√ß√£o e Aquisi√ß√£o (M√™s 1-2)</h3>
                        <p class="text-gray-300">Com a base pronta, iniciamos a atra√ß√£o de clientes qualificados, gerando os primeiros resultados e validando as estrat√©gias.</p>
                        <ul class="list-disc list-inside text-gray-400 mt-4 space-y-1">
                            <li><strong>Lan√ßamento das Campanhas:</strong> Ativa√ß√£o dos an√∫ncios com foco em convers√£o (mensagens/leads).</li>
                            <li><strong>Cria√ß√£o de An√∫ncios de Impacto:</strong> Desenvolvimento de criativos (v√≠deos/imagens) e copy persuasiva.</li>
                            <li><strong>Gera√ß√£o de Fluxo de Leads:</strong> Aumento do volume de contatos interessados nos roteiros.</li>
                            <li><strong>Primeiras Otimiza√ß√µes:</strong> An√°lise inicial de m√©tricas e ajustes para melhorar performance.</li>
                        </ul>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-icon">3</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 title-shadow">Fase 3: Otimiza√ß√£o e Escala (M√™s 3-4)</h3>
                        <p class="text-gray-300">√â hora de refinar a m√°quina. Usamos os dados para diminuir custos, aumentar o lucro e preparar para um crescimento acelerado.</p>
                        <ul class="list-disc list-inside text-gray-400 mt-4 space-y-1">
                            <li><strong>An√°lise de Dados e Testes A/B:</strong> Otimiza√ß√£o cont√≠nua de p√∫blicos, criativos e ofertas.</li>
                            <li><strong>Implementa√ß√£o de Remarketing:</strong> Campanhas para re-impactar quem j√° demonstrou interesse.</li>
                            <li><strong>Redu√ß√£o do Custo por Aquisi√ß√£o (CPA):</strong> Foco em tornar a aquisi√ß√£o de clientes mais barata.</li>
                            <li><strong>Escala Controlada:</strong> Aumento gradual do investimento nos an√∫ncios que mais performam.</li>
                        </ul>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-icon">4</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 title-shadow">Fase 4: Domina√ß√£o e Autoridade (Cont√≠nuo)</h3>
                        <p class="text-gray-300">Consolidamos a Serramar Trekking como a principal escolha na regi√£o, criando um ativo de marketing de longo prazo.</p>
                        <ul class="list-disc list-inside text-gray-400 mt-4 space-y-1">
                            <li><strong>Constru√ß√£o de Funil de Vendas:</strong> Estrat√©gias para nutrir leads e vender m√∫ltiplos roteiros.</li>
                            <li><strong>Expans√£o de Canais (Opcional):</strong> Testes em outras plataformas como Google Ads.</li>
                            <li><strong>Fortalecimento da Marca:</strong> Campanhas de alcance e reconhecimento para solidificar a autoridade.</li>
                            <li><strong>Consultoria Estrat√©gica:</strong> An√°lise de novas oportunidades de roteiros e ofertas.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-6 sm:py-8">
            <div class="section-gradient-box p-4 sm:p-8 max-w-6xl">
                <h2 class="text-2xl sm:text-4xl font-bold text-[#4CAF50] mb-4 text-center title-shadow">Planos de Parceria Estrat√©gica</h2>
                <p class="text-white mt-2 max-w-3xl mx-auto mb-12 text-center title-shadow">Cada plano foi desenhado para acompanhar uma fase do seu crescimento. O investimento nos an√∫ncios (or√ßamento di√°rio) √© flex√≠vel e pago diretamente √†s plataformas.</p>
            
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-stretch">
                    <div class="p-6 rounded-lg strong-shadow-box text-center">
                        <div class="card-content">
                            <div class="icon-highlight">üß≠</div>
                            <h3 class="text-xl font-bold text-white title-shadow">Plano Desbravador</h3>
                            <p class="text-sm text-gray-400">Ideal para Fases 1 e 2</p>
                            <p class="text-4xl font-bold text-[#4CAF50] mt-4">R$ 900<span class="text-lg font-semibold text-white">/m√™s</span></p>
                            <ul class="text-left text-sm text-white mt-6 space-y-2">
                                <li>‚úîÔ∏è Diagn√≥stico e Planejamento</li>
                                <li>‚úîÔ∏è Gest√£o de at√© 2 Campanhas</li>
                                <li>‚úîÔ∏è Foco no Roteiro Principal</li>
                                <li>‚úîÔ∏è Cria√ß√£o de 4 Criativos/m√™s</li>
                                <li>‚úîÔ∏è Segmenta√ß√£o de P√∫blico Essencial</li>
                                <li>‚úîÔ∏è Relat√≥rio Quinzenal de Performance</li>
                            </ul>
                        </div>
                        <button class="plan-button mt-6" data-plan="desbravador">Iniciar Jornada</button>
                    </div>

                    <div class="p-6 rounded-lg strong-shadow-box text-center border-4 border-[#4CAF50] transform scale-105 relative">
                        <div class="absolute -top-4 left-1/2 -translate-x-1/2 bg-[#4CAF50] text-white text-sm font-bold px-4 py-1 rounded-full">MAIS POPULAR</div>
                         <div class="card-content">
                            <div class="icon-highlight">üå≤</div>
                            <h3 class="text-xl font-bold text-white title-shadow">Plano Conquistador</h3>
                            <p class="text-sm text-gray-400">Ideal para Fases 2 e 3</p>
                            <p class="text-4xl font-bold text-[#4CAF50] mt-4">R$ 1.400<span class="text-lg font-semibold text-white">/m√™s</span></p>
                            <ul class="text-left text-sm text-white mt-6 space-y-2">
                                <li>‚úîÔ∏è <strong>Tudo do Desbravador</strong></li>
                                <li>‚úîÔ∏è Gest√£o de at√© 4 Campanhas</li>
                                <li>‚úîÔ∏è Cria√ß√£o de 8 Criativos/m√™s</li>
                                <li>‚úîÔ∏è <strong>Campanhas de Remarketing</strong></li>
                                <li>‚úîÔ∏è <strong>Testes A/B para Otimiza√ß√£o</strong></li>
                                <li>‚úîÔ∏è Relat√≥rio Semanal Detalhado</li>
                                <li>‚úîÔ∏è Suporte Priorit√°rio via WhatsApp</li>
                            </ul>
                        </div>
                        <button class="plan-button mt-6" data-plan="conquistador">Acelerar Crescimento</button>
                    </div>

                    <div class="p-6 rounded-lg strong-shadow-box text-center">
                         <div class="card-content">
                            <div class="icon-highlight">üèîÔ∏è</div>
                            <h3 class="text-xl font-bold text-white title-shadow">Plano Expedicion√°rio</h3>
                            <p class="text-sm text-gray-400">Ideal para Fases 3 e 4</p>
                            <p class="text-4xl font-bold text-[#4CAF50] mt-4">R$ 2.100<span class="text-lg font-semibold text-white">/m√™s</span></p>
                            <ul class="text-left text-sm text-white mt-6 space-y-2">
                                <li>‚úîÔ∏è <strong>Tudo do Conquistador</strong></li>
                                <li>‚úîÔ∏è Gest√£o de Campanhas Ilimitadas</li>
                                <li>‚úîÔ∏è <strong>Desenvolvimento de Funil de Vendas</strong></li>
                                <li>‚úîÔ∏è Cria√ß√£o de 12 Criativos/m√™s</li>
                                <li>‚úîÔ∏è Otimiza√ß√£o de Perfil (Instagram)</li>
                                <li>‚úîÔ∏è Reuni√£o Estrat√©gica Mensal</li>
                            </ul>
                        </div>
                        <button class="plan-button mt-6" data-plan="expedicionario">Dominar o Territ√≥rio</button>
                    </div>
                    
                    <div class="p-6 rounded-lg strong-shadow-box text-center">
                         <div class="card-content">
                            <div class="icon-highlight">üèÜ</div>
                            <h3 class="text-xl font-bold text-white title-shadow">Plano Cume</h3>
                            <p class="text-sm text-gray-400">Parceria Estrat√©gica Completa</p>
                            <p class="text-4xl font-bold text-[#4CAF50] mt-4">R$ 3.000<span class="text-lg font-semibold text-white">/m√™s</span></p>
                            <ul class="text-left text-sm text-white mt-6 space-y-2">
                                <li>‚úîÔ∏è <strong>Tudo do Expedicion√°rio</strong></li>
                                <li>‚úîÔ∏è <strong>Gest√£o Multi-Canal (Google Ads)</strong></li>
                                <li>‚úîÔ∏è Acompanhamento de Vendas</li>
                                <li>‚úîÔ∏è Consultoria de Neg√≥cio Cont√≠nua</li>
                                <li>‚úîÔ∏è Relat√≥rios Gerenciais Avan√ßados</li>
                                <li>‚úîÔ∏è Acesso Direto e Imediato</li>
                            </ul>
                        </div>
                        <button class="plan-button mt-6" data-plan="cume">Alcan√ßar o Cume</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="py-6 sm:py-8 text-center">
            <div class="section-gradient-box p-4 sm:p-8 max-w-4xl">
                <h2 class="text-2xl sm:text-4xl font-bold text-[#4CAF50] mb-4 flex items-center justify-center title-shadow">
                    <span class="icon-highlight mr-4">üöÄ</span> Pr√≥ximo Passo: Iniciar a Jornada
                </h2>
                <p class="text-base sm:text-lg text-white max-w-3xl mx-auto mb-8 title-shadow">
                    Roger, este plano √© o mapa para levarmos a Serramar Trekking ao pr√≥ximo n√≠vel. Com consist√™ncia e estrat√©gia, os resultados s√£o uma consequ√™ncia natural. Meu compromisso √© com o seu crescimento.
                </p>
                <p class="text-base sm:text-lg text-white max-w-3xl mx-auto mb-8 title-shadow">
                    <strong>B√¥nus de A√ß√£o R√°pida:</strong> Ao iniciarmos a parceria nos pr√≥ximos <strong>2 dias</strong>, eu incluo a <strong>an√°lise e otimiza√ß√£o completa do seu perfil no Instagram</strong> para maximizar a convers√£o do tr√°fego que vamos gerar.
                </p>
            </div>
        </section>
    </main>

    <!-- CONTRACT SECTION (Initially Hidden) -->
    <section id="contract-section" class="hidden container mx-auto p-2 sm:p-4 md:p-8">
        <div class="bg-[#1A202C] rounded-lg shadow-lg p-4 sm:p-6 section-gradient-box">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-[#4CAF50]">Contrato de Gest√£o de Performance</h1>
                <p id="contract-header-subtitle" class="text-gray-300 mt-2">Serramar Trekking & Matheus Henrique Laurindo</p>
            </header>

            <nav id="contract-tabs" class="flex flex-wrap border-b border-gray-700 mb-6">
                <button data-tab="overview" class="tab-button active text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Vis√£o Geral</button>
                <button data-tab="parties" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Partes</button>
                <button data-tab="services" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Servi√ßos</button>
                <button data-tab="financial" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Financeiro</button>
                <button data-tab="term" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Prazo e Rescis√£o</button>
                <button data-tab="obligations" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Obriga√ß√µes</button>
                <button data-tab="confidentiality" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Confidencialidade</button>
                <button data-tab="signatures" class="tab-button text-sm sm:text-base font-medium py-3 px-3 sm:px-5 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-500">Assinaturas</button>
            </nav>

            <main id="contract-content">
                <!-- Overview -->
                <section id="overview" class="tab-content prose max-w-none text-gray-300">
                    <p class="mb-6">Esta √© uma vis√£o geral dos termos mais importantes. Para detalhes completos, navegue pelas abas. Este painel resume o acordo para facilitar o entendimento.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-[#2D3748] p-6 rounded-lg">
                            <h3 class="font-bold text-lg mb-2 text-teal-400">Objeto Principal</h3>
                            <p id="overview-main-objective">Gest√£o de Performance de Marketing Digital para a Serramar Trekking.</p>
                        </div>
                        <div class="bg-[#2D3748] p-6 rounded-lg">
                            <h3 class="font-bold text-lg mb-2 text-teal-400">Valor Mensal (Plano Selecionado)</h3>
                            <p id="overview-price" class="text-2xl font-bold">--</p>
                        </div>
                        <div class="bg-[#2D3748] p-6 rounded-lg">
                            <h3 class="font-bold text-lg mb-2 text-teal-400">Prazo do Contrato</h3>
                            <p class="text-2xl font-bold">6 meses</p>
                            <p class="text-sm text-gray-400">Com renova√ß√£o autom√°tica.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Parties -->
                <section id="parties" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border border-gray-700 rounded-lg p-6">
                            <h3 class="font-bold text-xl mb-4 text-teal-500">CONTRATANTE (Serramar Trekking)</h3>
                            <div id="contratante-display" class="hidden space-y-2">
                                <p><strong>Raz√£o Social:</strong> <span id="display-nome-completo"></span></p>
                                <p><strong>CPF/CNPJ:</strong> <span id="display-cnpj"></span></p>
                                <p><strong>Endere√ßo:</strong> <span id="display-endereco"></span></p>
                                <p><strong>Telefone:</strong> <span id="display-telefone"></span></p>
                                <p><strong>E-mail:</strong> <span id="display-email"></span></p>
                                <button id="edit-contratante-btn" class="mt-4 px-4 py-2 bg-yellow-500 text-black rounded-md hover:bg-yellow-600">Editar Dados</button>
                            </div>
                            <div id="contratante-form" class="form-section">
                                <div class="input-group"><label for="input-nome-completo">Nome Completo/Raz√£o Social:</label><input type="text" id="input-nome-completo" placeholder="Nome Completo/Raz√£o Social" autocomplete="off"></div>
                                <div class="input-group"><label for="input-cnpj">CPF/CNPJ:</label><input type="text" id="input-cnpj" placeholder="CPF ou CNPJ" autocomplete="off"></div>
                                <div class="input-group"><label for="input-endereco">Endere√ßo:</label><input type="text" id="input-endereco" placeholder="Endere√ßo Completo" autocomplete="off"></div>
                                <div class="input-group"><label for="input-telefone">Telefone:</label><input type="text" id="input-telefone" placeholder="Telefone com DDD" autocomplete="off"></div>
                                <div class="input-group"><label for="input-email">E-mail:</label><input type="email" id="input-email" placeholder="E-mail de contato" autocomplete="off"></div>
                                <button id="save-contratante-btn" class="mt-2 px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600">Salvar Dados</button>
                            </div>
                        </div>
                        <div class="border border-gray-700 rounded-lg p-6">
                            <h3 class="font-bold text-xl mb-4 text-teal-500">CONTRATADO</h3>
                            <p><strong>Nome:</strong> Matheus Henrique Laurindo</p>
                            <p><strong>CPF:</strong> 100.936.909-16</p>
                            <p><strong>Endere√ßo:</strong> Rua Aquidab√£, 199, Escola Agr√≠cola, Blumenau, SC, 89037-740</p>
                            <p><strong>Telefone:</strong> (47) 99217-6490</p>
                            <p><strong>E-mail:</strong> laurindomatheus40@gmail.com</p>
                        </div>
                    </div>
                </section>
                <!-- Services -->
                <section id="services" class="tab-content hidden prose max-w-none text-gray-300">
                    <h2 class="text-teal-500">CL√ÅUSULA PRIMEIRA ‚Äì DO OBJETO DO CONTRATO</h2>
                    <p>O presente Contrato tem como objeto a presta√ß√£o de servi√ßos de Gest√£o de Performance de Marketing Digital pelo CONTRATADO para o CONTRATANTE, com foco em:</p>
                    <ul id="service-list" class="list-disc list-inside space-y-2">
                        <!-- Service items will be populated by JS -->
                    </ul>
                </section>
                <!-- Financial -->
                <section id="financial" class="tab-content hidden prose max-w-none text-gray-300">
                    <h2 class="text-teal-500">CL√ÅUSULA SEGUNDA ‚Äì DO VALOR E FORMA DE PAGAMENTO</h2>
                    <p>Pelos servi√ßos prestados, o CONTRATANTE pagar√° ao CONTRATADO o valor mensal de <strong id="financial-price" class="text-xl text-teal-400"></strong>.</p>
                    <p>O pagamento ser√° recorrente, com a primeira cobran√ßa na data de assinatura deste contrato e as subsequentes a cada 30 dias.</p>
                    <p>O investimento em an√∫ncios (or√ßamento de m√≠dia) √© de responsabilidade do CONTRATANTE e ser√° pago diretamente √†s plataformas (ex: Facebook, Google).</p>
                </section>
                <!-- Term and Termination -->
                <section id="term" class="tab-content hidden prose max-w-none text-gray-300">
                    <h2 class="text-teal-500">CL√ÅUSULA TERCEIRA ‚Äì DO PRAZO E DA RESCIS√ÉO</h2>
                    <p>3.1. O presente contrato ter√° vig√™ncia de 6 (seis) meses, a contar da data de sua assinatura, sendo renovado automaticamente por iguais per√≠odos, caso n√£o haja manifesta√ß√£o contr√°ria de qualquer das partes.</p>
                    <p>3.2. Qualquer das partes poder√° rescindir o presente contrato, a qualquer tempo, sem qualquer √¥nus, desde que notifique a outra parte, por escrito, com anteced√™ncia m√≠nima de 30 (trinta) dias.</p>
                    <p>3.3. Em caso de rescis√£o antecipada e imotivada por parte do CONTRATANTE antes do t√©rmino do prazo inicial de 6 meses, ser√° devida multa no valor de 20% sobre o valor restante do contrato.</p>
                </section>
                <!-- Obligations -->
                <section id="obligations" class="tab-content hidden prose max-w-none text-gray-300">
                     <h2 class="text-teal-500">CL√ÅUSULA QUARTA ‚Äì DAS OBRIGA√ß√µes</h2>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                             <h3 class="font-bold text-lg mb-2 text-teal-400">Obriga√ß√µes do CONTRATADO</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li>Prestar os servi√ßos descritos na Cl√°usula Primeira com zelo e profissionalismo.</li>
                                <li>Manter o CONTRATANTE informado sobre o andamento das campanhas atrav√©s dos relat√≥rios.</li>
                                <li>Manter sigilo sobre todas as informa√ß√µes do CONTRATANTE.</li>
                                <li>N√£o utilizar os materiais do CONTRATANTE para outros fins que n√£o os do presente contrato.</li>
                            </ul>
                         </div>
                         <div>
                              <h3 class="font-bold text-lg mb-2 text-teal-400">Obriga√ß√µes do CONTRATANTE</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li>Realizar os pagamentos mensais pontualmente.</li>
                                <li>Fornecer ao CONTRATADO todos os acessos e informa√ß√µes necess√°rias para a execu√ß√£o dos servi√ßos.</li>
                                <li>Realizar o pagamento do investimento em m√≠dia diretamente √†s plataformas de an√∫ncio.</li>
                                <li>Aprovar os criativos e estrat√©gias propostas em tempo h√°bil.</li>
                            </ul>
                         </div>
                       </div>
                </section>
                <!-- Confidentiality -->
                <section id="confidentiality" class="tab-content hidden prose max-w-none text-gray-300">
                    <h2 class="text-teal-500">CL√ÅUSULA QUINTA ‚Äì DA CONFIDENCIALIDADE</h2>
                    <p>As partes se comprometem a manter em absoluto sigilo e confidencialidade todas as informa√ß√µes, dados, materiais e documentos relacionados ao objeto deste contrato, n√£o podendo, sob qualquer pretexto, divulg√°-los, revel√°-los, reproduzi-los ou dar conhecimento deles a terceiros.</p>
                </section>
                <!-- Signatures -->
                <section id="signatures" class="tab-content hidden prose max-w-none text-gray-300">
                    <p>E, por estarem assim justas e contratadas, as partes assinam o presente Contrato.</p>
                    <p id="signature-date-location" class="font-semibold"></p>
                    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-12 text-center">
                        <div>
                            <p class="text-lg">Assinatura do Contratante:</p>
                            <div class="mt-4 flex flex-col items-center">
                                <canvas id="signature-canvas" class="signature-canvas w-full max-w-sm h-32 rounded-md"></canvas>
                                <button id="clear-signature-btn" class="mt-2 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Limpar</button>
                            </div>
                        </div>
                        <div>
                             <p class="text-lg">Assinatura do Contratado:</p>
                             <div class="mt-4 text-2xl font-serif italic text-teal-300">Matheus Henrique Laurindo</div>
                        </div>
                    </div>
                    <div class="text-center mt-12">
                        <button id="proceed-to-checkout-btn" class="plan-button text-lg bg-green-500 hover:bg-green-600">
                            <span id="btn-text">Assinar, Gerar PDF e Pagar</span>
                            <div id="btn-spinner" class="spinner hidden"></div>
                        </button>
                    </div>
                </section>
            </main>
        </div>
    </section>

    <!-- CHECKOUT SECTION (Initially Hidden) -->
    <section id="checkout-section" class="hidden container mx-auto p-2 sm:p-4 md:p-8">
         <div class="section-gradient-box p-4 sm:p-8 max-w-2xl mx-auto">
             <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-[#4CAF50]">Finalizar Pagamento</h1>
                <p id="checkout-summary" class="text-gray-300 mt-2">Plano selecionado: <span class="font-bold text-teal-400"></span></p>
            </header>
            <div class="flex justify-center">
                <div id="pix-container" class="p-6 rounded-lg strong-shadow-box text-center w-full md:w-2/3">
                    <!-- PIX content will be populated by JS -->
                </div>
            </div>
            <div class="text-center mt-8">
                 <button id="back-to-proposal-btn" class="text-teal-400 hover:text-teal-300">&larr; Voltar para a Proposta</button>
            </div>
         </div>
    </section>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, userId;
        let selectedPlan = {};
        let currentClientData = null; // Local state for client data
        
        const planDetails = {
            desbravador: { name: "Plano Desbravador", price: "R$ 900,00", services: ["Diagn√≥stico 360¬∞ e Planejamento Estrat√©gico.", "Gest√£o de at√© 2 campanhas de marketing simult√¢neas.", "Foco no roteiro principal para m√°xima tra√ß√£o inicial.", "Cria√ß√£o de 4 an√∫ncios (criativos) por m√™s.", "Segmenta√ß√£o de p√∫blico-alvo essencial.", "Envio de relat√≥rio quinzenal de performance."] },
            conquistador: { name: "Plano Conquistador", price: "R$ 1.400,00", services: ["Todos os itens do Plano Desbravador.", "Gest√£o de at√© 4 campanhas de marketing simult√¢neas.", "Cria√ß√£o de 8 an√∫ncios (criativos) por m√™s.", "Implementa√ß√£o de campanhas de Remarketing para re-impactar interessados.", "Realiza√ß√£o de Testes A/B para otimiza√ß√£o cont√≠nua de an√∫ncios.", "Envio de relat√≥rio semanal detalhado de performance.", "Suporte priorit√°rio via WhatsApp."] },
            expedicionario: { name: "Plano Expedicion√°rio", price: "R$ 2.100,00", services: ["Todos os itens do Plano Conquistador.", "Gest√£o de campanhas de marketing ilimitadas.", "Desenvolvimento e implementa√ß√£o de Funil de Vendas.", "Cria√ß√£o de 12 an√∫ncios (criativos) por m√™s.", "Otimiza√ß√£o de perfil e biografia do Instagram.", "Realiza√ß√£o de reuni√£o estrat√©gica mensal."] },
            cume: { name: "Plano Cume", price: "R$ 3.000,00", services: ["Todos os itens do Plano Expedicion√°rio.", "Gest√£o de marketing multi-canal (incluindo Google Ads).", "Acompanhamento de m√©tricas de vendas e ROI.", "Consultoria de neg√≥cio cont√≠nua para novas oportunidades.", "Envio de relat√≥rios gerenciais avan√ßados.", "Acesso direto e imediato para alinhamentos estrat√©gicos."] }
        };

        const proposalSection = document.getElementById('proposal-section');
        const contractSection = document.getElementById('contract-section');
        const checkoutSection = document.getElementById('checkout-section');
        const notificationToast = document.getElementById('notification-toast');

        function showNotification(message, type = 'info', duration = 4000) {
            notificationToast.textContent = message;
            notificationToast.className = `show ${type}`;
            setTimeout(() => { notificationToast.className = notificationToast.className.replace('show', ''); }, duration);
        }

        async function initializeFirebase() {
            try {
                // Use environment variables provided by the platform
                if (typeof __firebase_config === 'undefined') {
                    throw new Error("Configura√ß√£o do Firebase n√£o encontrada.");
                }
                const firebaseConfig = JSON.parse(__firebase_config);
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase Authenticated. User ID:", userId);
                    } else {
                        console.log("User is not authenticated.");
                    }
                });

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Falha na inicializa√ß√£o do Firebase:", error);
                showNotification("Erro ao conectar com o sistema de contratos.", "error", 10000);
            }
        }

        function setupContract(planKey) {
            selectedPlan = planDetails[planKey];
            document.getElementById('contract-header-subtitle').textContent = `Serramar Trekking & Matheus Henrique Laurindo - ${selectedPlan.name}`;
            const serviceList = document.getElementById('service-list');
            serviceList.innerHTML = '';
            selectedPlan.services.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                serviceList.appendChild(li);
            });
            document.getElementById('overview-price').textContent = selectedPlan.price;
            document.getElementById('financial-price').textContent = selectedPlan.price;
            document.getElementById('signature-date-location').textContent = `Blumenau, Santa Catarina, ${new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' })}`;
            
            proposalSection.classList.add('hidden');
            checkoutSection.classList.add('hidden');
            contractSection.classList.remove('hidden');
            document.querySelector('#contract-tabs .tab-button[data-tab="overview"]').click();
            window.scrollTo(0, 0);
        }
        
        async function generateContractPDF_ABNT(clientData, signatureDataURL) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });

            const marginLeft = 20, marginTop = 20, marginRight = 20;
            const pageWidth = 210;
            const usableWidth = pageWidth - marginLeft - marginRight;
            let y = marginTop;

            doc.setFont('helvetica', 'normal');

            const checkPageBreak = (currentY, neededHeight = 10) => {
                if (currentY > doc.internal.pageSize.height - 30) {
                    doc.addPage();
                    return marginTop;
                }
                return currentY;
            };

            const addSectionTitle = (title) => {
                y = checkPageBreak(y, 20);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(title, marginLeft, y);
                y += 8;
                doc.setDrawColor(200, 200, 200);
                doc.line(marginLeft, y, pageWidth - marginRight, y);
                y += 8;
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
            };
            
            const addSubTitle = (title) => {
                y = checkPageBreak(y);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(title, marginLeft, y);
                y += 6;
                doc.setFont('helvetica', 'normal');
            };

            const addText = (text, options = {}) => {
                y = checkPageBreak(y);
                const splitText = doc.splitTextToSize(text, usableWidth - (options.indent || 0));
                doc.text(splitText, marginLeft + (options.indent || 0), y);
                y += (splitText.length * 5) + (options.marginBottom || 0);
            };

            const addKeyValue = (key, value) => {
                y = checkPageBreak(y);
                doc.setFont('helvetica', 'bold');
                doc.text(key, marginLeft, y);
                doc.setFont('helvetica', 'normal');
                doc.text(value, marginLeft + 40, y);
                y += 7;
            };

            // --- VIS√ÉO GERAL ---
            addSectionTitle("Vis√£o Geral do Contrato");
            addKeyValue("Plano:", selectedPlan.name);
            addKeyValue("Valor Mensal:", selectedPlan.price);
            addKeyValue("Objeto:", "Gest√£o de Performance de Marketing Digital para a Serramar Trekking.");
            addKeyValue("Prazo Inicial:", "6 meses");
            y += 5;

            // --- PARTES ENVOLVIDAS ---
            addSectionTitle("Partes Envolvidas");
            addSubTitle("CONTRATANTE");
            addText(`Raz√£o Social: ${clientData.nomeCompleto}`);
            addText(`CPF/CNPJ: ${clientData.cnpj}`);
            addText(`Endere√ßo: ${clientData.endereco}`);
            addText(`Telefone: ${clientData.telefone}`);
            addText(`E-mail: ${clientData.email}`, { marginBottom: 5 });

            addSubTitle("CONTRATADO");
            addText("Nome: Matheus Henrique Laurindo");
            addText("CPF: 100.936.909-16");
            addText("Endere√ßo: Rua Aquidab√£, 199, Escola Agr√≠cola, Blumenau, SC, 89037-740");
            addText("Telefone: (47) 99217-6490");
            addText("E-mail: laurindomatheus40@gmail.com", { marginBottom: 5 });

            // --- SERVI√áOS ---
            addSectionTitle("CL√ÅUSULA PRIMEIRA ‚Äì DO OBJETO DO CONTRATO");
            addText("O presente Contrato tem como objeto a presta√ß√£o de servi√ßos de Gest√£o de Performance de Marketing Digital pelo CONTRATADO para o CONTRATANTE, com foco em:");
            selectedPlan.services.forEach(serv => {
                addText(`‚Ä¢ ${serv}`, { indent: 5 });
            });
            y += 5;

            // --- FINANCEIRO ---
            addSectionTitle("CL√ÅUSULA SEGUNDA ‚Äì DO VALOR E FORMA DE PAGAMENTO");
            addText(`Pelos servi√ßos prestados, o CONTRATANTE pagar√° ao CONTRATADO o valor mensal de ${selectedPlan.price}.`);
            addText("O pagamento ser√° recorrente, com a primeira cobran√ßa na data de assinatura deste contrato e as subsequentes a cada 30 dias.");
            addText("O investimento em an√∫ncios (or√ßamento de m√≠dia) √© de responsabilidade do CONTRATANTE e ser√° pago diretamente √†s plataformas (ex: Facebook, Google).", { marginBottom: 5 });

            // --- PRAZO E RESCIS√ÉO ---
            addSectionTitle("CL√ÅUSULA TERCEIRA ‚Äì DO PRAZO E DA RESCIS√ÉO");
            addText("3.1. O presente contrato ter√° vig√™ncia de 6 (seis) meses, a contar da data de sua assinatura, sendo renovado automaticamente por iguais per√≠odos, caso n√£o haja manifesta√ß√£o contr√°ria de qualquer das partes.");
            addText("3.2. Qualquer das partes poder√° rescindir o presente contrato, a qualquer tempo, sem qualquer √¥nus, desde que notifique a outra parte, por escrito, com anteced√™ncia m√≠nima de 30 (trinta) dias.");
            addText("3.3. Em caso de rescis√£o antecipada e imotivada por parte do CONTRATANTE antes do t√©rmino do prazo inicial de 6 meses, ser√° devida multa no valor de 20% sobre o valor restante do contrato.", { marginBottom: 5 });
            
            // --- OBRIGA√á√ïES ---
            addSectionTitle("CL√ÅUSULA QUARTA ‚Äì DAS OBRIGA√á√ïES");
            addSubTitle("Obriga√ß√µes do CONTRATADO");
            const contratadoObrigacoes = [
                "Prestar os servi√ßos descritos na Cl√°usula Primeira com zelo e profissionalismo.",
                "Manter o CONTRATANTE informado sobre o andamento das campanhas atrav√©s dos relat√≥rios.",
                "Manter sigilo sobre todas as informa√ß√µes do CONTRATANTE.",
                "N√£o utilizar os materiais do CONTRATANTE para outros fins que n√£o os do presente contrato."
            ];
            contratadoObrigacoes.forEach(o => addText(`‚Ä¢ ${o}`, { indent: 5 }));
            y += 5;

            addSubTitle("Obriga√ß√µes do CONTRATANTE");
            const contratanteObrigacoes = [
                "Realizar os pagamentos mensais pontualmente.",
                "Fornecer ao CONTRATADO todos os acessos e informa√ß√µes necess√°rias para a execu√ß√£o dos servi√ßos.",
                "Realizar o pagamento do investimento em m√≠dia diretamente √†s plataformas de an√∫ncio.",
                "Aprovar os criativos e estrat√©gias propostas em tempo h√°bil."
            ];
            contratanteObrigacoes.forEach(o => addText(`‚Ä¢ ${o}`, { indent: 5 }));
            y += 5;

            // --- CONFIDENCIALIDADE ---
            addSectionTitle("CL√ÅUSULA QUINTA ‚Äì DA CONFIDENCIALIDADE");
            addText("As partes se comprometem a manter em absoluto sigilo e confidencialidade todas as informa√ß√µes, dados, materiais e documentos relacionados ao objeto deste contrato, n√£o podendo, sob qualquer pretexto, divulg√°-los, revel√°-los, reproduzi-los ou dar conhecimento deles a terceiros.", { marginBottom: 15 });

            // --- ASSINATURAS ---
            addSectionTitle("Assinaturas");
            addText("E, por estarem assim justas e contratadas, as partes assinam o presente Contrato.");
            addText(`Local e Data: Blumenau, Santa Catarina, ${new Date().toLocaleDateString('pt-BR')}`, { marginBottom: 20 });
            
            y = checkPageBreak(y, 60);

            const signatureY = y;
            const contractorX = marginLeft;
            const contractedX = pageWidth / 2 + 10;
            
            if (signatureDataURL) {
                doc.addImage(signatureDataURL, 'PNG', contractorX, signatureY, 70, 25);
            }
            doc.line(contractorX, signatureY + 30, contractorX + 70, signatureY + 30);
            doc.text(clientData.nomeCompleto, contractorX, signatureY + 35);
            doc.text("CONTRATANTE", contractorX, signatureY + 40);

            doc.setFont('helvetica', 'italic');
            doc.text('Matheus Henrique Laurindo', contractedX, signatureY + 25);
            doc.setFont('helvetica', 'normal');
            doc.line(contractedX, signatureY + 30, contractedX + 70, signatureY + 30);
            doc.text('Matheus Henrique Laurindo', contractedX, signatureY + 35);
            doc.text("CONTRATADO", contractedX, signatureY + 40);

            const pdfDataUri = doc.output('datauristring');
            doc.save(`Contrato_${clientData.nomeCompleto.replace(/\s/g, '_')}.pdf`);
            return pdfDataUri;
        }

        function showCheckout() {
            document.getElementById('checkout-summary').querySelector('span').textContent = selectedPlan.name;
            const pixContainer = document.getElementById('pix-container');

            const pixKeys = {
                desbravador: "00020126580014br.gov.bcb.pix01361deca4c9-3098-45aa-bafe-533efe88ed795204000053039865406900.005802BR5925Matheus Henrique Laurindo6008Blumenau62290525MATHEUSH00000481225335ASA63043439",
                conquistador: "00020126800014br.gov.bcb.pix01361deca4c9-3098-45aa-bafe-533efe88ed790218Plano Conquistador52040000530398654071400.005802BR5925Matheus Henrique Laurindo6008Blumenau62290525MATHEUSH00000481261877ASA6304733F",
                expedicionario: "00020126580014br.gov.bcb.pix01361deca4c9-3098-45aa-bafe-533efe88ed7952040000530398654072100.005802BR5925Matheus Henrique Laurindo6008Blumenau62290525MATHEUSH00000481299721ASA63042A32",
                cume: "00020126580014br.gov.bcb.pix01361deca4c9-3098-45aa-bafe-533efe88ed7952040000530398654073000.005802BR5925Matheus Henrique Laurindo6008Blumenau62290525MATHEUSH00000481300745ASA63048680"
            };
            const planKey = Object.keys(planDetails).find(key => planDetails[key].name === selectedPlan.name);
            const pixKey = pixKeys[planKey];

            if (pixKey) {
                pixContainer.innerHTML = `
                    <h3 class="text-xl font-bold text-white title-shadow mb-4">Pagamento via PIX</h3>
                    <p class="text-gray-400 mb-4">Aponte a c√¢mera do seu celular para o QR Code ou copie a chave abaixo.</p>
                    <div class="flex flex-col items-center">
                        <div class="bg-white p-2 rounded-md inline-block">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(pixKey)}"
                                 alt="QR Code PIX" width="180" height="180" />
                        </div>
                        <div class="mt-4 w-full max-w-md">
                            <label for="pix-key-input" class="block text-xs text-gray-400 mb-1 text-left">Chave PIX:</label>
                            <div class="flex items-center">
                                <input type="text" id="pix-key-input" aria-label="Chave PIX" class="bg-gray-800 text-gray-300 text-xs p-1 rounded-l-md w-full" value="${pixKey}" readonly>
                                <button id="copy-pix-key-btn" class="bg-teal-500 text-white p-2 rounded-r-md hover:bg-teal-600" aria-label="Copiar chave PIX" title="Copiar chave PIX">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <span id="copy-feedback" class="text-green-400 text-xs mt-2 hidden">Chave copiada!</span>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-gray-400 text-xs">Ap√≥s o pagamento, envie o comprovante para <strong>laurindomatheus40@gmail.com</strong> ou WhatsApp <strong>(47) 99217-6490</strong>.</p>
                    </div>
                `;
                document.getElementById('copy-pix-key-btn').addEventListener('click', () => {
                    const pixKeyInput = document.getElementById('pix-key-input');
                    pixKeyInput.select();
                    pixKeyInput.setSelectionRange(0, 99999);
                    try {
                        document.execCommand('copy');
                        showNotification("Chave PIX copiada!", "success");
                    } catch (_) {
                        showNotification("Erro ao copiar a chave.", "error");
                    }
                });
            } else {
                pixContainer.innerHTML = `<p class="text-gray-400">Entre em contato para solicitar a chave PIX.</p>`;
            }

            contractSection.classList.add('hidden');
            checkoutSection.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await initializeFirebase();

            document.querySelectorAll('.plan-button[data-plan]').forEach(button => {
                button.addEventListener('click', () => setupContract(button.getAttribute('data-plan')));
            });

            const tabs = document.querySelectorAll('#contract-tabs .tab-button');
            const tabContents = document.querySelectorAll('#contract-content .tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetId);
                    });
                });
            });
            
            const contratanteDisplay = document.getElementById('contratante-display');
            const contratanteForm = document.getElementById('contratante-form');
            const editContratanteBtn = document.getElementById('edit-contratante-btn');
            
            document.getElementById('save-contratante-btn').addEventListener('click', () => {
                const dataToSave = {
                    nomeCompleto: document.getElementById('input-nome-completo').value,
                    cnpj: document.getElementById('input-cnpj').value,
                    endereco: document.getElementById('input-endereco').value,
                    telefone: document.getElementById('input-telefone').value,
                    email: document.getElementById('input-email').value,
                };
                if (!dataToSave.nomeCompleto || !dataToSave.cnpj) {
                    showNotification("Nome e CPF/CNPJ s√£o obrigat√≥rios.", "error");
                    return;
                }
                currentClientData = dataToSave;
                document.getElementById('display-nome-completo').textContent = dataToSave.nomeCompleto;
                document.getElementById('display-cnpj').textContent = dataToSave.cnpj;
                document.getElementById('display-endereco').textContent = dataToSave.endereco;
                document.getElementById('display-telefone').textContent = dataToSave.telefone;
                document.getElementById('display-email').textContent = dataToSave.email;
                contratanteForm.classList.add('hidden');
                contratanteDisplay.classList.remove('hidden');
                showNotification("Dados do contratante salvos.", "success");
            });

            editContratanteBtn.addEventListener('click', () => {
                contratanteDisplay.classList.add('hidden');
                contratanteForm.classList.remove('hidden');
            });
            
            const signatureCanvas = document.getElementById('signature-canvas');
            const signatureCtx = signatureCanvas.getContext('2d');
            let drawing = false;

            const getCoords = (e) => {
                const rect = signatureCanvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: clientX - rect.left, y: clientY - rect.top };
            }
            const startDrawing = (e) => { e.preventDefault(); drawing = true; const { x, y } = getCoords(e); signatureCtx.moveTo(x, y); };
            const endDrawing = () => { drawing = false; signatureCtx.beginPath(); };
            const draw = (e) => {
                if (!drawing) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                signatureCtx.lineWidth = 2;
                signatureCtx.lineCap = 'round';
                signatureCtx.strokeStyle = '#000000';
                signatureCtx.lineTo(x, y);
                signatureCtx.stroke();
                signatureCtx.beginPath();
                signatureCtx.moveTo(x, y);
            };
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mouseup', endDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseout', endDrawing);
            signatureCanvas.addEventListener('touchstart', startDrawing);
            signatureCanvas.addEventListener('touchend', endDrawing);
            signatureCanvas.addEventListener('touchmove', draw);

            document.getElementById('clear-signature-btn').addEventListener('click', () => {
                signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            });
            
            document.getElementById('proceed-to-checkout-btn').addEventListener('click', async (e) => {
                const button = e.currentTarget;
                const btnText = document.getElementById('btn-text');
                const btnSpinner = document.getElementById('btn-spinner');

                button.disabled = true;
                btnText.classList.add('hidden');
                btnSpinner.classList.remove('hidden');

                if (!currentClientData) {
                    showNotification("Por favor, preencha e salve os dados do contratante na aba 'Partes'.", "error");
                    document.querySelector('[data-tab="parties"]').click();
                    button.disabled = false;
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    return;
                }
                const docId = currentClientData.cnpj ? currentClientData.cnpj.replace(/\D/g,'') : '';
                if (!currentClientData.nomeCompleto || !docId || !currentClientData.email) {
                    showNotification("Dados do contratante incompletos.", "error");
                    document.querySelector('[data-tab="parties"]').click();
                    button.disabled = false;
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    return;
                }

                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = signatureCanvas.width; tempCanvas.height = signatureCanvas.height;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.fillStyle = '#fff'; tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(signatureCanvas, 0, 0);
                const signatureDataURL = tempCanvas.toDataURL('image/png');
                const emptyCanvas = document.createElement('canvas');
                emptyCanvas.width = signatureCanvas.width; emptyCanvas.height = signatureCanvas.height;
                if (signatureCanvas.toDataURL() === emptyCanvas.toDataURL()) {
                    showNotification("A assinatura do contratante √© obrigat√≥ria.", "error");
                    document.querySelector('[data-tab="signatures"]').click();
                    button.disabled = false;
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    return;
                }

                try {
                    showNotification("Gerando PDF do contrato...", "info");
                    const pdfDataUri = await generateContractPDF_ABNT(currentClientData, signatureDataURL);
                    showNotification("PDF gerado. Salvando no sistema...", "info");

                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';
                    const contractData = {
                        ...currentClientData,
                        planName: selectedPlan.name,
                        planPrice: selectedPlan.price,
                        planServices: selectedPlan.services,
                        signature: signatureDataURL,
                        signedAt: new Date().toISOString(),
                        pdfData: pdfDataUri
                    };
                    if (!userId) throw new Error("Usu√°rio n√£o autenticado.");
                    const finalContractRef = doc(db, 'artifacts', appId, 'public', 'data', 'contracts', docId);
                    await setDoc(finalContractRef, contractData);
                    showNotification("Contrato salvo com sucesso!", "success");

                    showCheckout();

                } catch (error) {
                    console.error("Erro ao processar o contrato:", error);
                    showNotification(`Erro: ${error.message}`, "error");
                } finally {
                    button.disabled = false;
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                }
            });

            document.getElementById('back-to-proposal-btn').addEventListener('click', () => {
                checkoutSection.classList.add('hidden');
                proposalSection.classList.remove('hidden');
                window.scrollTo(0, 0);
            });
        });
    </script>
</body>
</html>
